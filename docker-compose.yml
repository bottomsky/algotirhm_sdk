version: "3.9"

services:
  consul:
    image: hashicorp/consul:1.16
    command: "agent -dev -client=0.0.0.0 -ui"
    ports:
      - "8500:8500"
    healthcheck:
      test: ["CMD", "consul", "info"]
      interval: 5s
      timeout: 3s
      retries: 5

  algo-service:
    build: .
    depends_on:
      - consul
    ports:
      - "8000:8000"
    environment:
      SERVICE_REGISTRY_ENABLED: "true"
      SERVICE_REGISTRY_HOST: "http://consul:8500"
      SERVICE_NAME: "algo-service"
      SERVICE_VERSION: "v1"
      SERVICE_PROTOCOL: "http"
      SERVICE_PORT: "8000"
      SERVICE_BIND_HOST: "0.0.0.0"
      # Override with a LAN IP or gateway hostname when clients are outside docker network.
      SERVICE_HOST: "${ALGO_PUBLIC_HOST:-algo-service}"
      ALGO_MODULES: "algo_core_service.algorithms"
